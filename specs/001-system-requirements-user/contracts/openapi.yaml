openapi: 3.0.3
info:
  title: Al-Shorouk Radiology Management System API
  description: Multi-role healthcare management platform for radiology departments
  version: 1.0.0
  contact:
    name: Al-Shorouk Hospital
    email: support@alshorouk.com

servers:
  - url: https://api.alshorouk.com/v1
    description: Production server
  - url: https://staging-api.alshorouk.com/v1
    description: Staging server
  - url: http://localhost:3000/v1
    description: Development server

security:
  - BearerAuth: []

paths:
  # Authentication endpoints
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and return JWT token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "nurse_sarah"
                password:
                  type: string
                  format: password
                  example: "SecurePass123!"
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  refresh_token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh JWT token
      description: Get new access token using refresh token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # User management endpoints
  /users:
    get:
      tags:
        - Users
      summary: List users
      description: Retrieve list of users (admin only)
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/RoleFilter'
      responses:
        '200':
          description: Users list
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  total:
                    type: integer
                    example: 25
        '403':
          $ref: '#/components/responses/ForbiddenError'

    post:
      tags:
        - Users
      summary: Create user
      description: Create new user (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
                - role
                - full_name
              properties:
                username:
                  type: string
                  example: "doctor_ahmed"
                email:
                  type: string
                  format: email
                  example: "ahmed@alshorouk.com"
                password:
                  type: string
                  format: password
                  example: "SecurePass123!"
                role:
                  type: string
                  enum: [nurse, doctor, admin]
                  example: "doctor"
                full_name:
                  type: string
                  example: "Dr. Ahmed Mohamed"
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '409':
          description: Username or email already exists

  /users/{user_id}:
    get:
      tags:
        - Users
      summary: Get user
      description: Get user by ID
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Users
      summary: Update user
      description: Update user details (admin or self)
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                full_name:
                  type: string
                is_active:
                  type: boolean
                role:
                  type: string
                  enum: [nurse, doctor, admin]
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # Patient management endpoints
  /patients:
    get:
      tags:
        - Patients
      summary: Search patients
      description: Search patients by name or national ID
      parameters:
        - $ref: '#/components/parameters/SearchParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: Patients list
          content:
            application/json:
              schema:
                type: object
                properties:
                  patients:
                    type: array
                    items:
                      $ref: '#/components/schemas/Patient'
                  total:
                    type: integer
                    example: 15

    post:
      tags:
        - Patients
      summary: Create patient
      description: Create new patient record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePatientRequest'
      responses:
        '201':
          description: Patient created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '409':
          description: National ID or medical number already exists

  /patients/{patient_id}:
    get:
      tags:
        - Patients
      summary: Get patient
      description: Get patient by ID
      parameters:
        - $ref: '#/components/parameters/PatientIdParam'
      responses:
        '200':
          description: Patient details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Patients
      summary: Update patient
      description: Update patient details
      parameters:
        - $ref: '#/components/parameters/PatientIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePatientRequest'
      responses:
        '200':
          description: Patient updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /patients/{patient_id}/visits:
    get:
      tags:
        - Patients
      summary: Get patient visits
      description: Get visit history for patient
      parameters:
        - $ref: '#/components/parameters/PatientIdParam'
      responses:
        '200':
          description: Patient visits
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Visit'

  # Visit management endpoints
  /visits:
    get:
      tags:
        - Visits
      summary: List visits
      description: List visits with filtering
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/StatusFilter'
        - $ref: '#/components/parameters/NurseFilter'
        - $ref: '#/components/parameters/DoctorFilter'
      responses:
        '200':
          description: Visits list
          content:
            application/json:
              schema:
                type: object
                properties:
                  visits:
                    type: array
                    items:
                      $ref: '#/components/schemas/Visit'
                  total:
                    type: integer
                    example: 30

    post:
      tags:
        - Visits
      summary: Create visit
      description: Create new patient visit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVisitRequest'
      responses:
        '201':
          description: Visit created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Visit'

  /visits/{visit_id}:
    get:
      tags:
        - Visits
      summary: Get visit
      description: Get visit by ID with related forms
      parameters:
        - $ref: '#/components/parameters/VisitIdParam'
      responses:
        '200':
          description: Visit details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisitWithForms'

    put:
      tags:
        - Visits
      summary: Update visit
      description: Update visit details
      parameters:
        - $ref: '#/components/parameters/VisitIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateVisitRequest'
      responses:
        '200':
          description: Visit updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Visit'

  # Nurse form endpoints
  /nurse-forms:
    get:
      tags:
        - Nurse Forms
      summary: List nurse forms
      description: List nurse forms with filtering
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/StatusFilter'
      responses:
        '200':
          description: Nurse forms list
          content:
            application/json:
              schema:
                type: object
                properties:
                  forms:
                    type: array
                    items:
                      $ref: '#/components/schemas/NurseForm'
                  total:
                    type: integer
                    example: 20

    post:
      tags:
        - Nurse Forms
      summary: Create nurse form
      description: Create new nursing assessment form
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateNurseFormRequest'
      responses:
        '201':
          description: Nurse form created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NurseForm'

  /nurse-forms/{form_id}:
    get:
      tags:
        - Nurse Forms
      summary: Get nurse form
      description: Get nurse form by ID
      parameters:
        - $ref: '#/components/parameters/FormIdParam'
      responses:
        '200':
          description: Nurse form details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NurseForm'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Nurse Forms
      summary: Update nurse form
      description: Update nursing assessment form
      parameters:
        - $ref: '#/components/parameters/FormIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNurseFormRequest'
      responses:
        '200':
          description: Nurse form updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NurseForm'

  /nurse-forms/{form_id}/sign:
    post:
      tags:
        - Nurse Forms
      summary: Sign nurse form
      description: Add digital signature to nurse form
      parameters:
        - $ref: '#/components/parameters/FormIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignatureRequest'
      responses:
        '200':
          description: Form signed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NurseForm'

  # Doctor form endpoints
  /doctor-forms:
    get:
      tags:
        - Doctor Forms
      summary: List doctor forms
      description: List doctor forms with filtering
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/StatusFilter'
      responses:
        '200':
          description: Doctor forms list
          content:
            application/json:
              schema:
                type: object
                properties:
                  forms:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorForm'
                  total:
                    type: integer
                    example: 15

    post:
      tags:
        - Doctor Forms
      summary: Create doctor form
      description: Create new doctor evaluation form
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDoctorFormRequest'
      responses:
        '201':
          description: Doctor form created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DoctorForm'

  /doctor-forms/{form_id}:
    get:
      tags:
        - Doctor Forms
      summary: Get doctor form
      description: Get doctor form by ID
      parameters:
        - $ref: '#/components/parameters/FormIdParam'
      responses:
        '200':
          description: Doctor form details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DoctorForm'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Doctor Forms
      summary: Update doctor form
      description: Update doctor evaluation form
      parameters:
        - $ref: '#/components/parameters/FormIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDoctorFormRequest'
      responses:
        '200':
          description: Doctor form updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DoctorForm'

  /doctor-forms/{form_id}/sign-doctor:
    post:
      tags:
        - Doctor Forms
      summary: Sign doctor form (doctor)
      description: Add doctor's digital signature
      parameters:
        - $ref: '#/components/parameters/FormIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignatureRequest'
      responses:
        '200':
          description: Form signed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DoctorForm'

  /doctor-forms/{form_id}/sign-patient:
    post:
      tags:
        - Doctor Forms
      summary: Sign doctor form (patient)
      description: Add patient's digital signature
      parameters:
        - $ref: '#/components/parameters/FormIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignatureRequest'
      responses:
        '200':
          description: Form signed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DoctorForm'

  # Admin endpoints
  /admin/audit-logs:
    get:
      tags:
        - Admin
      summary: Get audit logs
      description: Get system audit logs (admin only)
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/DateRangeFilter'
      responses:
        '200':
          description: Audit logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditLog'
                  total:
                    type: integer
                    example: 100

  /admin/health:
    get:
      tags:
        - Admin
      summary: System health check
      description: Get system health metrics (admin only)
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  database:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "connected"
                      response_time:
                        type: number
                        example: 12.5
                  websocket:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "running"
                      connections:
                        type: integer
                        example: 5
                  uptime:
                    type: string
                    example: "2d 5h 30m"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    LimitParam:
      name: limit
      in: query
      description: Number of items to return
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

    OffsetParam:
      name: offset
      in: query
      description: Number of items to skip
      schema:
        type: integer
        minimum: 0
        default: 0

    SearchParam:
      name: search
      in: query
      description: Search term
      schema:
        type: string
        minLength: 1
        maxLength: 100

    UserIdParam:
      name: user_id
      in: path
      description: User ID
      required: true
      schema:
        type: string
        format: uuid

    PatientIdParam:
      name: patient_id
      in: path
      description: Patient ID
      required: true
      schema:
        type: string
        format: uuid

    VisitIdParam:
      name: visit_id
      in: path
      description: Visit ID
      required: true
      schema:
        type: string
        format: uuid

    FormIdParam:
      name: form_id
      in: path
      description: Form ID
      required: true
      schema:
        type: string
        format: uuid

    RoleFilter:
      name: role
      in: query
      description: Filter by role
      schema:
        type: string
        enum: [nurse, doctor, admin]

    StatusFilter:
      name: status
      in: query
      description: Filter by status
      schema:
        type: string

    NurseFilter:
      name: nurse_id
      in: query
      description: Filter by nurse ID
      schema:
        type: string
        format: uuid

    DoctorFilter:
      name: doctor_id
      in: query
      description: Filter by doctor ID
      schema:
        type: string
        format: uuid

    DateRangeFilter:
      name: date_from
      in: query
      description: Filter logs from date
      schema:
        type: string
        format: date
    DateRangeFilterTo:
      name: date_to
      in: query
      description: Filter logs to date
      schema:
        type: string
        format: date

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        username:
          type: string
          example: "nurse_sarah"
        email:
          type: string
          format: email
          example: "sarah@alshorouk.com"
        role:
          type: string
          enum: [nurse, doctor, admin]
          example: "nurse"
        full_name:
          type: string
          example: "Sarah Johnson"
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"
        last_login:
          type: string
          format: date-time
          example: "2025-09-24T09:15:00Z"

    Patient:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174001"
        full_name:
          type: string
          example: "Mohamed Ali"
        national_id:
          type: string
          example: "1234567890"
        medical_number:
          type: string
          example: "MED-2025-001"
        date_of_birth:
          type: string
          format: date
          example: "1985-03-15"
        gender:
          type: string
          enum: [male, female, other]
          example: "male"
        mobile_number:
          type: string
          example: "+20 123 456 7890"
        address:
          type: string
          example: "123 Cairo Street, Egypt"
        emergency_contact:
          type: object
          properties:
            name:
              type: string
              example: "Fatima Ali"
            relationship:
              type: string
              example: "Spouse"
            phone:
              type: string
              example: "+20 987 654 3210"
        created_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"

    CreatePatientRequest:
      type: object
      required:
        - full_name
        - national_id
        - medical_number
        - date_of_birth
        - gender
        - mobile_number
      properties:
        full_name:
          type: string
          example: "Mohamed Ali"
        national_id:
          type: string
          example: "1234567890"
        medical_number:
          type: string
          example: "MED-2025-001"
        date_of_birth:
          type: string
          format: date
          example: "1985-03-15"
        gender:
          type: string
          enum: [male, female, other]
          example: "male"
        mobile_number:
          type: string
          example: "+20 123 456 7890"
        address:
          type: string
          example: "123 Cairo Street, Egypt"
        emergency_contact:
          $ref: '#/components/schemas/EmergencyContact'

    UpdatePatientRequest:
      type: object
      properties:
        full_name:
          type: string
          example: "Mohamed Ali"
        mobile_number:
          type: string
          example: "+20 123 456 7890"
        address:
          type: string
          example: "123 Cairo Street, Egypt"
        emergency_contact:
          $ref: '#/components/schemas/EmergencyContact'

    EmergencyContact:
      type: object
      properties:
        name:
          type: string
          example: "Fatima Ali"
        relationship:
          type: string
          example: "Spouse"
        phone:
          type: string
          example: "+20 987 654 3210"

    Visit:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174002"
        patient_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174001"
        nurse_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        doctor_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174003"
        status:
          type: string
          enum: [draft, in_progress, nurse_signed, doctor_signed, completed]
          example: "in_progress"
        visit_date:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"
        arrival_mode:
          type: string
          example: "ambulance"
        chief_complaint:
          type: string
          example: "Chest pain for 2 hours"
        created_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"

    VisitWithForms:
      allOf:
        - $ref: '#/components/schemas/Visit'
        - type: object
          properties:
            nurse_form:
              $ref: '#/components/schemas/NurseForm'
            doctor_form:
              $ref: '#/components/schemas/DoctorForm'

    CreateVisitRequest:
      type: object
      required:
        - patient_id
        - doctor_id
      properties:
        patient_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174001"
        doctor_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174003"
        arrival_mode:
          type: string
          example: "ambulance"
        chief_complaint:
          type: string
          example: "Chest pain for 2 hours"

    UpdateVisitRequest:
      type: object
      properties:
        doctor_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174003"
        status:
          type: string
          enum: [draft, in_progress, nurse_signed, doctor_signed, completed]
          example: "in_progress"

    NurseForm:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174004"
        visit_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174002"
        nurse_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        status:
          type: string
          enum: [draft, signed]
          example: "draft"
        assessment_data:
          type: object
          example:
            basic_info:
              arrival_mode: "ambulance"
              chief_complaint: "Chest pain for 2 hours"
            vital_signs:
              temperature: 37.2
              pulse: 85
              blood_pressure_systolic: 120
              blood_pressure_diastolic: 80
              respiratory_rate: 18
              o2_saturation: 98
            morse_fall_scale:
              history_of_falling: false
              secondary_diagnosis: true
              ambulatory_aid: false
              iv_heparin_lock: false
              gait_transfer: false
              mental_status: false
              total_score: 15
        created_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"
        signed_at:
          type: string
          format: date-time
          example: "2025-09-24T11:00:00Z"
        signature:
          $ref: '#/components/schemas/DigitalSignature'

    CreateNurseFormRequest:
      type: object
      required:
        - visit_id
        - assessment_data
      properties:
        visit_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174002"
        assessment_data:
          type: object
          example:
            basic_info:
              arrival_mode: "ambulance"
              chief_complaint: "Chest pain for 2 hours"
            vital_signs:
              temperature: 37.2
              pulse: 85
              blood_pressure_systolic: 120
              blood_pressure_diastolic: 80
              respiratory_rate: 18
              o2_saturation: 98
            morse_fall_scale:
              history_of_falling: false
              secondary_diagnosis: true
              ambulatory_aid: false
              iv_heparin_lock: false
              gait_transfer: false
              mental_status: false
              total_score: 15

    UpdateNurseFormRequest:
      type: object
      required:
        - assessment_data
      properties:
        assessment_data:
          type: object
          example:
            basic_info:
              arrival_mode: "ambulance"
              chief_complaint: "Chest pain for 2 hours"
            vital_signs:
              temperature: 37.2
              pulse: 85
              blood_pressure_systolic: 120
              blood_pressure_diastolic: 80
              respiratory_rate: 18
              o2_saturation: 98
            morse_fall_scale:
              history_of_falling: false
              secondary_diagnosis: true
              ambulatory_aid: false
              iv_heparin_lock: false
              gait_transfer: false
              mental_status: false
              total_score: 15

    DoctorForm:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174005"
        visit_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174002"
        doctor_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174003"
        status:
          type: string
          enum: [draft, signed]
          example: "draft"
        evaluation_data:
          type: object
          example:
            patient_information:
              age: 40
              weight: 75.5
              height: 175
              allergies: "Penicillin"
            study_indication:
              primary_indication: "Chest pain evaluation"
              clinical_history: "Hypertension, smoker"
            technical_parameters:
              ctd1vol: 250.5
              dlp: 450.2
              kv: 120
              mas: 200
              contrast_used: true
              contrast_volume: 100
        created_at:
          type: string
          format: date-time
          example: "2025-09-24T12:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-09-24T12:00:00Z"
        signed_at:
          type: string
          format: date-time
          example: "2025-09-24T12:30:00Z"
        doctor_signature:
          $ref: '#/components/schemas/DigitalSignature'
        patient_signature:
          $ref: '#/components/schemas/DigitalSignature'

    CreateDoctorFormRequest:
      type: object
      required:
        - visit_id
        - evaluation_data
      properties:
        visit_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174002"
        evaluation_data:
          type: object
          example:
            patient_information:
              age: 40
              weight: 75.5
              height: 175
              allergies: "Penicillin"
            study_indication:
              primary_indication: "Chest pain evaluation"
              clinical_history: "Hypertension, smoker"
            technical_parameters:
              ctd1vol: 250.5
              dlp: 450.2
              kv: 120
              mas: 200
              contrast_used: true
              contrast_volume: 100

    UpdateDoctorFormRequest:
      type: object
      required:
        - evaluation_data
      properties:
        evaluation_data:
          type: object
          example:
            patient_information:
              age: 40
              weight: 75.5
              height: 175
              allergies: "Penicillin"
            study_indication:
              primary_indication: "Chest pain evaluation"
              clinical_history: "Hypertension, smoker"
            technical_parameters:
              ctd1vol: 250.5
              dlp: 450.2
              kv: 120
              mas: 200
              contrast_used: true
              contrast_volume: 100

    SignatureRequest:
      type: object
      required:
        - signature_data
      properties:
        signature_data:
          type: string
          description: Base64 encoded signature data
          example: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z/C/HgAGgwJ/lK3Q6wAAAABJRU5ErkJggg=="

    DigitalSignature:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174006"
        form_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174004"
        form_type:
          type: string
          enum: [nurse_form, doctor_form_patient, doctor_form_doctor]
          example: "nurse_form"
        user_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        signature_data:
          type: string
          example: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z/C/HgAGgwJ/lK3Q6wAAAABJRU5ErkJggg=="
        signed_at:
          type: string
          format: date-time
          example: "2025-09-24T11:00:00Z"

    AuditLog:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174007"
        user_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        action:
          type: string
          example: "CREATE_PATIENT"
        entity_type:
          type: string
          example: "patients"
        entity_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174001"
        old_values:
          type: object
          example: null
        new_values:
          type: object
          example:
            full_name: "Mohamed Ali"
            national_id: "1234567890"
        ip_address:
          type: string
          example: "192.168.1.100"
        user_agent:
          type: string
          example: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        created_at:
          type: string
          format: date-time
          example: "2025-09-24T10:30:00Z"

  responses:
    BadRequestError:
      description: Bad request
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Invalid request parameters"
              details:
                type: object
                example:
                  field: "national_id"
                  message: "Invalid national ID format"

    UnauthorizedError:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Invalid or expired token"

    ForbiddenError:
      description: Forbidden
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Insufficient permissions"

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Patient not found"

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Validation failed"
              details:
                type: array
                items:
                  type: object
                  properties:
                    field:
                      type: string
                      example: "email"
                    message:
                      type: string
                      example: "Invalid email format"

    ConflictError:
      description: Resource conflict
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Username already exists"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Internal server error"

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Users
    description: User management and profiles
  - name: Patients
    description: Patient management and demographics
  - name: Visits
    description: Visit management and workflow
  - name: Nurse Forms
    description: Nursing assessment forms and signatures
  - name: Doctor Forms
    description: Doctor evaluation forms and signatures
  - name: Admin
    description: Administrative functions and monitoring